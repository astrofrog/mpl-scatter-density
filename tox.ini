[tox]
envlist =
    py{36,37,38,39,310,311}-test{,-image}
    codestyle
requires =
    setuptools >= 30.3.0
    pip >= 19.3.1
isolated_build = true

[testenv]
setenv =
    image: MPLFLAGS = --mpl
    !image: MPLFLAGS =
changedir = .tmp/{envname}
deps =
    # matplotlib versions older than 3.8 are incompatible with numpy>=2.0
    # but didn't include an upper boundary in their metadata
    mpl30: matplotlib==3.0.*
    mpl30: numpy<2.0
    mpl31: matplotlib==3.1.*
    mpl31: numpy<2.0
    mpl32: matplotlib==3.2.*
    mpl32: numpy<2.0
    mpl33: matplotlib==3.3.*
    mpl33: numpy<2.0
    mpl34: matplotlib==3.4.*
    mpl34: numpy<2.0
    mpl35: matplotlib==3.5.*
    mpl35: numpy<2.0
    mpl36: matplotlib==3.6.*
    mpl36: numpy<2.0
    mpl37: matplotlib==3.7.*
    mpl37: numpy<2.0
    mpl38: matplotlib==3.8.*
    mpl39: matplotlib==3.9.*
    mpldev: git+https://github.com/matplotlib/matplotlib.git#egg=matplotlib
extras =
    test

commands =
    pip freeze
    pytest --pyargs mpl_scatter_density {env:MPLFLAGS} --cov mpl_scatter_density --cov-config={toxinidir}/setup.cfg {posargs}

[testenv:codestyle]
skip_install = true
description = check code style
deps = flake8
changedir = {toxinidir}
commands = flake8 mpl_scatter_density --count --max-line-length=100
